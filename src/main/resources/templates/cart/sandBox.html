<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns:data-th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
</head>
<body>
<section class="h-100 h-custom" style="background-color: #ffffff;">
    <div class="container py-5 h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-12">
                <div class="card card-registration card-registration-2" style="border-radius: 15px;">
                    <div class="card-body p-0">
                        <div class="row g-0">
                            <div class="col-lg-8">
                                <div class="p-5">
                                    <h3>Available Items</h3>
                                    <div class="row">

                                        <div th:each="item : ${items}" class="col-md-4">
                                            <div class="card mb-3">
                                                <img th:src="${item.image}" class="card-img-top" alt="Item Image">
                                                <div class="card-body">
                                                    <h5 class="card-title" th:text="${item.name}"></h5>
                                                    <p class="card-text"
                                                       th:text="'Price: ' + ${item.price} + ' KRW'"></p>
                                                    <p class="card-text" th:text="'Category: ' + ${item.category}"></p>


                                                    <button class="btn btn-primary"
                                                            th:data-id="${item.id}"
                                                            th:data-name="${item.name}"
                                                            th:data-price="${item.price}"
                                                            th:data-image="${item.image}"
                                                            th:data-category="${item.category}"
                                                            th:data-quantity="1"
                                                            th:data-check="true"
                                                            onclick="addToCart(this)">
                                                        Add to Cart
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="btn btn-dark btn-block btn-lg" onclick="location.href='/cart/test'">
                                        장바구니로 이동
                                    </button>


                                    <button class="btn btn-primary"
                                            onclick="resetStorage()">
                                        로컬스토리지 초기화
                                    </button>

                                </div>
                            </div>
                            <div class="col-lg-4 d-none d-lg-block">
                                <h4>Shopping Cart</h4>
                                <p>Check your items in the localStorage.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    function resetStorage() {
        localStorage.clear()
        alert("로컬스토리지 초기화 완료");
    }

    // function goToCart() {
    //     // Get existing cart from localStorage
    //     let cart = localStorage.getItem('cart');
    //     if (!cart) {
    //         alert("Your cart is empty.");
    //         return;
    //     }
    //
    //     cart = JSON.parse(cart);
    //
    //     // Prepare the data to send
    //     const itemIds = [];
    //     const quantities = [];
    //
    //     cart.forEach(item => {
    //         itemIds.push(item.id);
    //         quantities.push(item.quantity);
    //     });
    //
    //     // Send data to the serve
    //     fetch('/cart/test', {
    //         method: 'GET',
    //         headers: {
    //             'Content-Type': 'application/json',
    //         },
    //         body: JSON.stringify({
    //             itemIds: itemIds,
    //             quantities: quantities,
    //         }),
    //     })
    //         .then(response => {
    //             if (response.ok) {
    //                 window.location.href = '/cart/test'; // Redirect after successful submission
    //             } else {
    //                 alert("Failed to send cart data.");
    //             }
    //         })
    //         .catch(error => {
    //             console.error("Error:", error);
    //             alert("An error occurred while sending data.");
    //         });
    // }


    function addToCart(button) {
        // 데이터 종합해서 JSON화 시키기
        const item = {
            id: button.dataset.id,
            name: button.dataset.name,
            price: button.dataset.price,
            image: button.dataset.image,
            category: button.dataset.category,
            quantity: button.dataset.quantity,
            check: button.dataset.check

        };

        // 로컬 스토리지 중복 검사 로직
        let cart = localStorage.getItem('cart');
        if (!cart) {
            cart = [];
        } else {
            cart = JSON.parse(cart);
        }
        const itemExists = cart.some(cartItem => cartItem.id === item.id);

        if (itemExists) {
            alert(item.name + " is already in the cart!");
        }
        else {
            // 장바구니에 추가
            cart.push(item);

            // 로컬스토리지 업데이트
            localStorage.setItem('cart', JSON.stringify(cart));
            alert(item.name + " added to cart!");
        }
    }
</script>
</body>
</html>
